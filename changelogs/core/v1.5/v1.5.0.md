# v1.5

This update is more focused on bug fixes and code maintenance.

## Web socket API breaking changes

The entire API for the `HttpWebSocket` class was changed. The motivation for this change was to reduce async/await errors, since the internal WebSocket object doesn't provide a synchronous API. This API rewrite fixes memory leak issues, error handling in asynchronous events, and message pooling.

- No more synchronous methods or events.
- All `Send()` methods were removed. Use `SendAsync()` overloads instead.
- No more `WaitForExit()` methods. Use `ReceiveMessageAsync()` with a cancellation token or timeout instead.
- No more `Close()`. Use `CloseAsync()` instead.

Read the updated docs for more info.

## Bug fixes and other changes

- Added the `LogMode` property for the `HttpContext` class. With this property, you can decide which log modes are enabled for the current context, which will override the current route log mode.
- Added the `HttpContext.GetCurrentContext()` method, which returns the current `HttpContext` if the current thread is running on a HTTP request context.
- Added the `HttpResponse.GetHeaderValue()` helper method, which attempts to get an header value from both defined `HttpResponse.Content.Headers` property or `HttpResponse.Headers`.
- Added the `HttpServerConfiguration.DefaultAccessLogFormat` constant.
- Added the `TypedValueDictionary.GetValue` and `TypedValueDictionary.SetValue` helper methods.
- Added the `MimeHelper.IsPlainTextMimeType` helper method.
- Added the `{:header}` constant literal for the log-formatting options.
- Improved exception-handling for forwarding resolvers.
- Fixed an issue where the `ForwardingResolver` methods could throw an exception before the initialization of the `HttpRequest` object, which caused the `HttpServerExecutionResult.HttpRequest` to have an null `HttpRequest` object.
- Fixed an possible stack overflow issue when using `InitializationParameterCollection.ContainsKey`.
- Fixed an issue where the HTTP server were compressing already compressed contents through the `EnableAutomaticResponseCompression` option.
- Fixed an issue where the HTTP server were trying to send responses generated by the `Router.CallbackErrorHandler`, `Router.NotFoundErrorHandler`, `Router.MethodNotAllowedErrorHandler` to contexts where was streaming content.
- Fixed issues where some HTTP headers could be set after sending content on the `HttpResponseStreamManager` class.
- Fixed issues in the access log formatter.
- Fixed an issue where the HTTP server was not enabling error-logging for user-handled errors.